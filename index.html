<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oppili Engineering | Consulting & Mechanical Services</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #004d99; /* Deep Blue for Oppili */
            --secondary-color: #f7a61d; /* Gold/Orange Accent */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        /* Custom styles for the active tab */
        .tab.active {
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .citation-link {
            font-size: 0.75rem;
            color: var(--primary-color);
            margin-top: 0.5rem;
            display: block;
            opacity: 0.8;
        }
    </style>
</head>
<body>

    <!-- Header and Navigation -->
    <header class="shadow-lg bg-white sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4 md:justify-start md:space-x-10">
                <div class="flex justify-start lg:w-0 lg:flex-1">
                    <a href="#" class="flex items-center text-xl font-extrabold text-[var(--primary-color)]">
                        <img class="h-8 w-auto sm:h-10 mr-2" src="https://placehold.co/40x40/004d99/ffffff?text=OE" alt="Oppili Engineering Logo">
                        Oppili Engineering
                    </a>
                </div>
                
                <!-- Navigation Tabs/Links -->
                <nav class="flex space-x-4">
                    <button id="tab-home" data-target="content-home" class="tab active text-gray-700 hover:bg-gray-100 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 ease-in-out" onclick="showTab('content-home')">Home</button>
                    
                    <!-- NEW TAB 1: News & Insights -->
                    <button id="tab-news" data-target="content-news" class="tab text-gray-700 hover:bg-gray-100 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 ease-in-out" onclick="showTab('content-news')">News & Insights</button>
                    
                    <!-- NEW TAB 2: Contact -->
                    <button id="tab-contact" data-target="content-contact" class="tab text-gray-700 hover:bg-gray-100 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 ease-in-out" onclick="showTab('content-contact')">Contact</button>
                </nav>

                <div class="hidden md:flex items-center justify-end md:flex-1 lg:w-0">
                    <!-- Placeholder for future action button -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto mt-8 px-4 sm:px-6 lg:px-8">
        
        <!-- 1. Home Content (Existing/Default Page) -->
        <section id="content-home" class="content-section">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold mb-4 text-[var(--primary-color)]">Welcome to Oppili Engineering</h1>
                <p class="text-lg text-gray-600 mb-6">
                    Specialist mechanical and building services consultancy based in Newcastle, NSW. We combine technical excellence with practical industry insight to deliver innovative and sustainable solutions for complex building and infrastructure projects.
                </p>
                <a href="#" onclick="showTab('content-contact')" class="inline-block bg-[var(--secondary-color)] text-white font-semibold py-3 px-6 rounded-lg hover:bg-opacity-90 transition duration-150 ease-in-out shadow-md">
                    Get in Touch Today
                </a>
            </div>
        </section>

        <!-- 2. News & Insights Content (Initial state: Hidden) -->
        <section id="content-news" class="content-section hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-[var(--primary-color)] border-b pb-2">Latest News & Engineering Insights</h2>
                
                <!-- Automated News Section -->
                <h3 class="text-2xl font-semibold mt-8 mb-4">Automated Industry Updates (via AI Search)</h3>
                <div id="automated-news-container" class="space-y-6">
                    <!-- Loading Indicator -->
                    <div id="news-loading" class="flex items-center justify-center p-8 text-gray-500">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-[var(--primary-color)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Fetching the latest Australian HVAC standards and NCC updates...
                    </div>
                </div>

                <!-- Manual/In-House News Section -->
                <h3 class="text-2xl font-semibold mt-10 mb-4 border-t pt-4">Oppili Engineering Announcements</h3>
                
                <!-- Placeholder News Item 1 -->
                <article class="mb-8 border-b pb-6">
                    <h4 class="text-xl font-semibold text-gray-800 mb-2">Sustainable HVAC Solutions for Modern Datacentres</h4>
                    <p class="text-sm text-gray-500 mb-3">Published: October 15, 2024</p>
                    <p class="text-gray-600">
                        Our latest analysis explores how next-generation geothermal and passive cooling techniques are revolutionizing the energy consumption profile of high-density computing environments in the Australian climate. Read more about our project with the Sydney Tech Hub.
                    </p>
                    <a href="#" class="text-[var(--primary-color)] font-medium mt-2 inline-block hover:underline">Continue reading &rarr;</a>
                </article>

                <!-- Placeholder News Item 2 -->
                <article class="mb-4">
                    <h4 class="text-xl font-semibold text-gray-800 mb-2">Oppili Engineering Expands RPEQ Services to Queensland</h4>
                    <p class="text-sm text-gray-500 mb-3">Published: September 28, 2024</p>
                    <p class="text-gray-600">
                        We are proud to announce the expansion of our services, now officially registered to provide professional engineering services across Queensland, led by Venkat Narasimhan (RPEQ 28511).
                    </p>
                    <a href="#" class="text-[var(--primary-color)] font-medium mt-2 inline-block hover:underline">Read the full announcement &rarr;</a>
                </article>
            </div>
        </section>

        <!-- 3. Contact Content (Initial state: Hidden) -->
        <section id="content-contact" class="content-section hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-[var(--primary-color)]">Get in Touch with Oppili Engineering</h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Contact Information -->
                    <div>
                        <p class="text-lg text-gray-700 mb-4">
                            We look forward to discussing your mechanical, building services, or infrastructure project.
                        </p>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <span class="text-[var(--secondary-color)] mr-3">&#9993;</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Email</p>
                                    <a href="mailto:venkat.n@oppiliengg.com.au" class="text-[var(--primary-color)] hover:underline">venkat.n@oppiliengg.com.au</a>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <span class="text-[var(--secondary-color)] mr-3">&#9742;</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Mobile</p>
                                    <a href="tel:+61422985601" class="text-[var(--primary-color)] hover:underline">0422 985 601</a>
                                </div>
                            </div>
                            <div class="flex">
                                <span class="text-[var(--secondary-color)] mr-3">&#127968;</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Location</p>
                                    <p class="text-gray-600">Newcastle, NSW, Australia</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Form Placeholder -->
                    <div>
                        <form action="#" method="POST" class="space-y-4">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" name="name" id="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] p-2 border">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" name="email" id="email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] p-2 border">
                            </div>
                            <div>
                                <label for="message" class="block text-sm font-medium text-gray-700">Project Details / Message</label>
                                <textarea id="message" name="message" rows="4" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] p-2 border"></textarea>
                            </div>
                            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[var(--primary-color)] hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-color)] transition duration-150 ease-in-out">
                                Send Message
                            </button>
                            <p class="text-xs text-gray-500 mt-2">Note: This form is a placeholder and requires backend integration to send emails.</p>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="mt-12 py-6 border-t border-gray-200 text-center text-gray-500 text-sm">
            &copy; 2024 Oppili Engineering. All rights reserved. | Built by Gemini.
        </footer>
    </main>

    <script>
        // --- Gemini API Configuration and Fetching ---
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const apiKey = ""; // API key is provided by the canvas environment

        // Function to create an HTML article from the API response
        function createNewsArticle(title, content, sources) {
            const article = document.createElement('article');
            article.className = 'mb-6 p-4 border rounded-lg bg-gray-50 shadow-sm';
            
            // Title
            const h4 = document.createElement('h4');
            h4.className = 'text-xl font-semibold text-gray-800 mb-2';
            h4.textContent = title;
            article.appendChild(h4);

            // Date (Current Date for 'latest' content)
            const dateP = document.createElement('p');
            dateP.className = 'text-sm text-gray-500 mb-3';
            const now = new Date();
            dateP.textContent = 'Published: ' + now.toLocaleDateString('en-AU', { month: 'long', day: 'numeric', year: 'numeric' }) + ' (Automated)';
            article.appendChild(dateP);

            // Content
            const contentP = document.createElement('p');
            contentP.className = 'text-gray-600 mb-2';
            contentP.textContent = content;
            article.appendChild(contentP);

            // Citations
            if (sources && sources.length > 0) {
                const sourceDiv = document.createElement('div');
                sourceDiv.className = 'mt-3 pt-2 border-t border-gray-200';
                
                const sourceTitle = document.createElement('p');
                sourceTitle.className = 'text-xs font-medium text-gray-600';
                sourceTitle.textContent = 'Sources:';
                sourceDiv.appendChild(sourceTitle);

                sources.slice(0, 3).forEach(source => { // Limit to 3 sources
                    const link = document.createElement('a');
                    link.href = source.uri;
                    link.target = '_blank';
                    link.className = 'citation-link hover:underline';
                    link.textContent = `- ${source.title}`;
                    sourceDiv.appendChild(link);
                });
                article.appendChild(sourceDiv);
            }

            return article;
        }

        // Main function to fetch automated news
        async function fetchAutomatedNews() {
            const container = document.getElementById('automated-news-container');
            const loadingIndicator = document.getElementById('news-loading');
            
            // Hide previous content and show loading indicator
            container.innerHTML = ''; 
            container.appendChild(loadingIndicator);

            const systemPrompt = "You are an expert Australian Mechanical/HVAC engineer and compliance analyst. Your task is to find the absolute latest, highly relevant news, standards, and regulatory updates in the Australian Building Services and HVAC industry, especially focusing on NCC or BCA changes. Summarize the findings into a compelling article title and a concise 3-4 sentence paragraph suitable for a professional consultancy website. The output MUST be a JSON array of two separate news items.";
            
            // We use a query that covers the key areas of the consultancy's focus
            const userQuery = "Find the two most critical, current updates for Australian HVAC engineering, including any recent NCC, Section J, or RPEQ-related standards changes.";

            // Define the JSON structure for the model to follow
            const responseSchema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "title": { "type": "STRING", "description": "A compelling, professional title for the news update." },
                        "summary": { "type": "STRING", "description": "A concise, 3-4 sentence summary of the update." }
                    },
                    required: ["title", "summary"]
                }
            };

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                },
            };

            // Use exponential backoff for robust API calling
            const maxRetries = 5;
            let currentDelay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(API_URL + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    // Process response and display
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const jsonText = candidate.content.parts[0].text;
                        const newsItems = JSON.parse(jsonText);
                        
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions.map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            })).filter(source => source.uri && source.title);
                        }

                        container.innerHTML = ''; // Clear loading indicator
                        
                        if (Array.isArray(newsItems)) {
                            newsItems.forEach(item => {
                                const article = createNewsArticle(item.title, item.summary, sources);
                                container.appendChild(article);
                            });
                        } else {
                            throw new Error("API did not return a valid JSON array structure.");
                        }
                        return; // Success, exit loop
                    }
                    throw new Error("API response content structure invalid.");

                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, currentDelay));
                        currentDelay *= 2; // Exponential backoff
                    } else {
                        // Final failure: show error message
                        container.innerHTML = '<div class="p-4 bg-red-100 text-red-700 rounded-lg">Error loading automated news: Please try refreshing the page.</div>';
                    }
                }
            }
        }
        
        // --- Tab Switching Logic ---
        function showTab(targetId) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Deactivate all tab buttons
            document.querySelectorAll('.tab').forEach(button => {
                button.classList.remove('active');
                button.classList.remove('bg-[var(--secondary-color)]');
                button.classList.remove('text-white');
                button.classList.add('text-gray-700');
                button.classList.add('hover:bg-gray-100');
            });

            // Show the selected content section
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }

            // Activate the corresponding tab button
            const targetButton = document.querySelector(`[data-target="${targetId}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
                targetButton.classList.remove('text-gray-700');
                targetButton.classList.remove('hover:bg-gray-100');
                targetButton.classList.add('bg-[var(--secondary-color)]');
                targetButton.classList.add('text-white');
            }

            // Special check: If the News tab is opened, fetch the automated news
            if (targetId === 'content-news') {
                fetchAutomatedNews();
            }
        }

        // Initialize: ensure the home tab is active on load
        window.onload = () => {
             // Set up the initial state to the 'Home' tab.
             showTab('content-home');
        };
    </script>
</body>
</html>
